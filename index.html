<html>
	<head>
		<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
		<script src="https://unpkg.com/aframe-template-component@3.2.1/dist/aframe-template-component.min.js"></script>
		
		<script src="components/slide.js"></script>
	</head>
	<body>
		<a-scene id="app">
			<a-asset>
				
				
				<video id="video" crossorigin="anonymous" src="assets/teste.mp4" autoplay loop="true"></video>
				
				
			</a-asset>
			
			<a-videosphere id="#sphere" src="#video" rotation="0 0 0"></a-videosphere>
			
			<script>
				
				
			
				
				// Data sample of how to use window slider
				// TODO : ADD rotation and "time"
				slide = {
					"id" : "myid" ,
					"position" : "0 3 -8" ,
					"rotation" : "0 0 0" ,
					"size" : 
					{
						"width" : 8 ,
						"height" : 5 ,
					},
					"title" : "Materials" ,
					"slides" : 
					[
					 	{ 
							"title" : "Experiment",
							"type" : "text" ,
							"value" : "simple description\nhere" ,
							"size" : 8 ,
						},
						{
							"title" : "Test tube 100mL",
							"type" : "image" ,
							"url" : "assets/test_tube_100_ml.jpg" ,
							"width" : 5 ,
							"height" : 3 ,
						},
						{
							"title" : "Erlenmeyer flask 250mL",
							"type" : "image" ,
							"url" : "assets/erlenmeyer_flask_250_ml.jpg" ,
							"width" : 5 ,
							"height" : 3 ,
						},
						{
							"title" : "Becker 100mL",
							"type" : "image" ,
							"url" : "assets/becker_100_ml.jpg" ,
							"width" : 5 ,
							"height" : 3 ,
						},
						{
							"title" : "Rubber bulbs",
							"type" : "image" ,
							"url" : "assets/rubber_bulbs.jpg" ,
							"width" : 3 ,
							"height" : 5 ,
						},
						{
							"title" : "Volumetric pipette 100mL",
							"type" : "image" ,
							"url" : "assets/volumetric_pipette_100_ml.jpg" ,
							"width" : 5 ,
							"height" : 3 ,
						},
						{
							"title" : "Burette 25 mL",
							"type" : "image" ,
							"url" : "assets/burette_25_ml.jpg" ,
							"width" : 3 ,
							"height" : 5 ,
						},
						{
							"title" : "Magnetic stir bar",
							"type" : "image" ,
							"url" : "assets/magnetic_stir_bar.jpg" ,
							"width" : 5 ,
							"height" : 3 ,
						},
						{
							"title" : "Magnetic stirrer mixer",
							"type" : "image" ,
							"url" : "assets/magnetic_stirrer_mixer.jpg" ,
							"width" : 5 ,
							"height" : 3 ,
						},
						{
							"title" : "pH electrode",
							"type" : "image" ,
							"url" : "assets/ph_electrode.jpg" ,
							"width" : 3 ,
							"height" : 5 ,
						},{
							"title" : "Digital pH meter",
							"type" : "image" ,
							"url" : "assets/digital_ph_meter.jpg" ,
							"width" : 3 ,
							"height" : 5 ,
						},{
							"title" : "Hot plate stirrer",
							"type" : "image" ,
							"url" : "assets/hot_plate_stirrer.jpg" ,
							"width" : 5 ,
							"height" : 3 ,
						},{
							"title" : "Burette support",
							"type" : "image" ,
							"url" : "assets/burette_support.jpg" ,
							"width" : 3 ,
							"height" : 5 ,
						},
						{
							"title" : "Aqueous solution of HCl",
							"type" : "image" ,
							"url" : "assets/aqueous_solution_hcl.jpg" ,
							"width" : 3 ,
							"height" : 5 ,
						},{
							"title" : "Aqueous solution of NaOH",
							"type" : "image" ,
							"url" : "assets/aqueous_solution_naoh.jpg" ,
							"width" : 3 ,
							"height" : 5 ,
						},
						{
							"title" : "Phenolphthalein",
							"type" : "image" ,
							"url" : "assets/phenolphthalein.jpg" ,
							"width" : 5 ,
							"height" : 3 ,
						},
					] 	
				};
				
				app = document.getElementById("app")
				
				// script to generate an slider
				x = document.createElement("a-entity")
				x.setAttribute("a-slide","json:"+JSON.stringify(slide))				
				app.appendChild(x)
				
			</script>
			

			<!-- Camera + Cursor. -->
			<a-camera>
				<a-cursor
				id="cursor"
				animation__click="property: scale; from: 0.1 0.1 0.1; to: 1 1 1; easing: easeInCubic; dur: 150; startEvents: click"
				animation__clickreset="property: scale; to: 1 1 1; dur: 1; startEvents: animationcomplete__click"
				animation__fusing="property: scale; from: 1 1 1; to: 0.1 0.1 0.1; easing: easeInCubic; dur: 150; startEvents: fusing">
				</a-cursor>
			</a-camera>
		</a-scene>
		<script>
			//console.log(document.querySelector("#video"))
			//document.querySelector("#video").currentTime = 100
			
			let video = document.querySelector('#video')
			video.muted = true

			// Times in seconds.
			const timeframes = [
			  {time: 0, triggered: false},
			  {time: 1, triggered: false},
			  {time: 3, triggered: false},
			  {time: 30, triggered: false},
			  {time: 60, triggered: false},
			  {time: 90, triggered: false}
			]

			// Watch for currentTime changes
			video.addEventListener('timeupdate', () => {
			  // Find the time to be triggered
			  let time = timeframes.find(i => i.time == Math.floor(video.currentTime) && !i.triggered)
			  if (time) {
				// A time was found that hasn't been triggered
				time.triggered = true
				// Send the event to the window
				window.dispatchEvent(new CustomEvent('VideoTimelapse', {detail: time}))
			  }
			})

			// Listen for the event
			window.addEventListener('VideoTimelapse', (e) => {
			  console.log(`${e.detail.time} seconds have passed`)
			})

			// The user moved the slider, reset the 'triggered' property back to false
			video.addEventListener('seeked', () => timeframes.forEach(i => {i.triggered = false}))
			
		</script>
	</body>
</html>
